{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*!\r\n\r\n=========================================================\r\n* NextJS Material Dashboard v1.1.0 based on Material Dashboard React v1.9.0\r\n=========================================================\r\n\r\n* Product Page: https://www.creative-tim.com/product/nextjs-material-dashboard\r\n* Copyright 2021 Creative Tim (https://www.creative-tim.com)\r\n* Licensed under MIT (https://github.com/creativetimofficial/nextjs-material-dashboard/blob/master/LICENSE.md)\r\n\r\n* Coded by Creative Tim\r\n\r\n=========================================================\r\n\r\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n\r\n*/\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"next/app\";\nimport Head from \"next/head\";\nimport Router from \"next/router\";\nimport PageChange from \"components/PageChange/PageChange.js\";\nimport \"assets/css/nextjs-material-dashboard.css?v=1.1.0\";\nimport ThemeContextProvider from \"../context/ThemeContextProvider\";\nimport THEMES from \"../constants/THEMES\";\nimport UserContextProvider from \"../context/UserContextProvider\";\nimport nookies from 'nookies';\nimport { hideLoad, showLoad } from \"../utils/loading\";\nimport { getPatient } from \"../services/userAuth\";\nimport GLOBAL_GET_TOKEN from \"../utils/token\";\nimport MessageDialog from \"../components/Dialogs/MessageDialog\";\nimport MessageDialogContextProvider from \"../context/MessageDialogContextProvider\";\nimport '../styles/globals.css';\nRouter.events.on(\"routeChangeStart\", function (url) {\n  showLoad(url);\n});\nRouter.events.on(\"routeChangeComplete\", function () {\n  hideLoad();\n});\nRouter.events.on(\"routeChangeError\", function () {\n  hideLoad();\n});\n\nvar MyApp = /*#__PURE__*/function (_App) {\n  _inherits(MyApp, _App);\n\n  var _super = _createSuper(MyApp);\n\n  function MyApp() {\n    _classCallCheck(this, MyApp);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(MyApp, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var comment = document.createComment(\"\\n\\n=========================================================\\n* * NextJS Material Dashboard v1.1.0 based on Material Dashboard React v1.9.0\\n=========================================================\\n\\n* Product Page: https://www.creative-tim.com/product/nextjs-material-dashboard\\n* Copyright 2021 Creative Tim (https://www.creative-tim.com)\\n* Licensed under MIT (https://github.com/creativetimofficial/nextjs-material-dashboard/blob/master/LICENSE.md)\\n\\n* Coded by Creative Tim\\n\\n=========================================================\\n\\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\\n\\n\");\n      document.insertBefore(comment, document.documentElement);\n    } // GetInitialProps corre tanto en server al principio, como en cliente al cambiar de pagina. \n    // La logica requerida solo es requerida al correr del server al principio, por tanto no valido que corra desde el cliente.\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          Component = _this$props.Component,\n          pageProps = _this$props.pageProps,\n          consultorioId = _this$props.consultorioId,\n          initUser = _this$props.initUser;\n\n      var Layout = Component.layout || function (_ref) {\n        var children = _ref.children;\n        return /*#__PURE__*/_jsx(_Fragment, {\n          children: children\n        });\n      };\n\n      return /*#__PURE__*/_jsx(ThemeContextProvider, {\n        theme: THEMES[consultorioId - 1],\n        children: /*#__PURE__*/_jsx(UserContextProvider, {\n          initUser: _objectSpread(_objectSpread({}, initUser), {}, {\n            consultorioId: consultorioId\n          }),\n          children: /*#__PURE__*/_jsxs(React.Fragment, {\n            children: [/*#__PURE__*/_jsxs(Head, {\n              children: [/*#__PURE__*/_jsx(\"meta\", {\n                name: \"viewport\",\n                content: \"width=device-width, initial-scale=1, shrink-to-fit=no\"\n              }), /*#__PURE__*/_jsx(\"title\", {\n                children: \"NextJS Material Dashboard by Creative Tim\"\n              }), /*#__PURE__*/_jsx(\"script\", {\n                src: \"https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE\"\n              })]\n            }), /*#__PURE__*/_jsx(Layout, {\n              children: /*#__PURE__*/_jsx(MessageDialogContextProvider, {\n                children: /*#__PURE__*/_jsx(Component, _objectSpread({}, pageProps))\n              })\n            })]\n          })\n        })\n      });\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n        var _cookies$loginTries;\n\n        var Component, router, ctx, pageProps, consultorioId, cookies, initUser, _id$token, id, token, patientResponse, _cookies$loginTries2;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                Component = _ref2.Component, router = _ref2.router, ctx = _ref2.ctx;\n                pageProps = {};\n                consultorioId = router.query.consultorioId;\n                cookies = nookies.get(ctx); // Setear o pedir id de consultorio\n\n                if (consultorioId) {\n                  // Set\n                  nookies.set(ctx, 'consultorioId', consultorioId, {\n                    maxAge: 50 * 365 * 24 * 60 * 60,\n                    path: '/'\n                  });\n                } else {\n                  consultorioId = cookies.consultorioId;\n                } // Redirigir de admin si el usuario no esta logueado\n\n\n                if (cookies.id === undefined && router.asPath.includes(\"admin\") && false) {\n                  ctx.res.writeHead(302, {\n                    Location: '/login/' + consultorioId,\n                    'Content-Type': 'text/html; charset=utf-8'\n                  });\n                  ctx.res.end();\n                } // Setear si existe, el usuario que ya esta logueado\n\n\n                if (!(cookies.id !== undefined && Number((_cookies$loginTries = cookies.loginTries) !== null && _cookies$loginTries !== void 0 ? _cookies$loginTries : 0) <= 2 && false && !router.asPath.includes(\"server-error\"))) {\n                  _context.next = 32;\n                  break;\n                }\n\n                _context.prev = 7;\n                _context.t0 = cookies.id;\n                _context.next = 11;\n                return GLOBAL_GET_TOKEN(ctx);\n\n              case 11:\n                _context.t1 = _context.sent;\n                _id$token = {\n                  id: _context.t0,\n                  token: _context.t1\n                };\n                id = _id$token.id;\n                token = _id$token.token;\n                console.log({\n                  id: id,\n                  consultorioId: consultorioId,\n                  token: token\n                });\n                _context.next = 18;\n                return getPatient(id, consultorioId, token);\n\n              case 18:\n                patientResponse = _context.sent;\n                console.log({\n                  patientResponse: patientResponse\n                });\n\n                if (patientResponse.success) {\n                  _context.next = 22;\n                  break;\n                }\n\n                throw Error(\"\");\n\n              case 22:\n                initUser = patientResponse.data;\n\n                if (!router.asPath.includes(\"admin\") && !router.asPath.includes(\"testing\")) {\n                  ctx.res.writeHead(302, {\n                    Location: '/admin/' + consultorioId + \"/dashboard\",\n                    'Content-Type': 'text/html; charset=utf-8'\n                  });\n                  ctx.res.end(); // ctx.res.finished = true;\n                }\n\n                _context.next = 32;\n                break;\n\n              case 26:\n                _context.prev = 26;\n                _context.t2 = _context[\"catch\"](7);\n                nookies.set(ctx, 'loginTries', Number((_cookies$loginTries2 = cookies.loginTries) !== null && _cookies$loginTries2 !== void 0 ? _cookies$loginTries2 : 0) + 1, {\n                  maxAge: 60,\n                  path: '/'\n                });\n\n                if (Number(cookies.loginTries) === 2) {\n                  nookies.destroy(ctx, \"id\", {\n                    path: \"/\"\n                  });\n                  nookies.destroy(ctx, \"dni\", {\n                    path: \"/\"\n                  });\n                  nookies.destroy(ctx, \"loginTries\", {\n                    path: \"/\"\n                  });\n                }\n\n                ctx.res.writeHead(302, {\n                  Location: '/login/' + consultorioId + \"/server-error\",\n                  'Content-Type': 'text/html; charset=utf-8'\n                });\n                ctx.res.end(); // ctx.res.finished = true;\n\n              case 32:\n                if (!Component.getInitialProps) {\n                  _context.next = 36;\n                  break;\n                }\n\n                _context.next = 35;\n                return Component.getInitialProps(ctx);\n\n              case 35:\n                pageProps = _context.sent;\n\n              case 36:\n                return _context.abrupt(\"return\", {\n                  pageProps: pageProps,\n                  consultorioId: consultorioId,\n                  initUser: initUser\n                });\n\n              case 37:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[7, 26]]);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return MyApp;\n}(App);\n\nexport { MyApp as default };","map":null,"metadata":{},"sourceType":"module"}